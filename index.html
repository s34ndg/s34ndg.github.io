<!DOCTYPE html>
<html>
<head>
    <title>Web Audio App</title>
    <style>
        /* Add CSS styles to customize the UI */
    </style>
</head>
<body>
<h1>Web Audio App</h1>
<button id="startButton">Start</button>
<p id="statusText">Not listening</p>
<label for="silenceDuration">Silence Duration (in seconds):</label>
<input type="number" id="silenceDuration" min="1" value="5">
<p id="ambientNoiseLevel">Ambient Noise Level: <span id="noiseLevelValue">-</span> dB</p>
<label for="audioThresholdInput">Audio Threshold:</label>
<input type="number" id="audioThresholdInput" min="-100" max="0" step="1">
<button id="calibrationButton">Calibrate</button>

<footer>
    <p>Version 0.0.13</p>
</footer>

<script>
        // Variables
        let audioThreshold = 60; // Default audio threshold in dB
        let silenceDuration = 5; // Default silence duration in seconds
        let ambientNoiseLevel = 0; // Ambient noise level (calibrated value)

        // Function to check for audio silence and show notification
        function checkAudioSilence() {
            const audioContext = new AudioContext();
            const analyser = audioContext.createAnalyser();
            const bufferLength = analyser.fftSize;

            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    const source = audioContext.createMediaStreamSource(stream);
                    source.connect(analyser);

                    setInterval(() => {
                        const dataArray = new Uint8Array(bufferLength);
                        analyser.getByteTimeDomainData(dataArray);

                        const average = dataArray.reduce((sum, value) => sum + value, 0) / bufferLength;
                        const audioLevel = 20 * Math.log10(average / 128);

                        if (audioLevel <= audioThreshold) {
                            silenceDuration -= 1;
                        } else {
                            silenceDuration = 5; // Reset silence duration if audio detected
                        }

                        if (silenceDuration === 0) {
                            showNotification('Silence Detected', 'No audio detected for the specified period');
                        }
                    }, 1000); // Check audio levels every second
                })
                .catch(error => {
                    console.error('Error accessing microphone:', error);
                });
        }

        // Function to show a pop-up notification
        function showNotification(title, message) {
            if (Notification.permission === 'granted') {
                new Notification(title, { body: message });
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        new Notification(title, { body: message });
                    }
                });
            }
        }

        // Function to start the audio silence detection
        function startDetection() {
            // Reset silence duration
            silenceDuration = 5;
            checkAudioSilence();
        }

        // Function to handle the form submission and update thresholds
        function handleFormSubmit(event) {
            event.preventDefault();

            const audioThresholdInput = document.getElementById('audioThreshold');
            const silenceDurationInput = document.getElementById('silenceDuration');

            audioThreshold = parseInt(audioThresholdInput.value);
            silenceDuration = parseInt(silenceDurationInput.value);

            // Reset silence duration
            silenceDuration = 5;
        }

        // Add event listener to start button
        const startButton = document.getElementById('startButton');
        startButton.addEventListener('click', startDetection);

        // Add event listener to form submit
        const settingsForm = document.getElementById('settingsForm');
        settingsForm.addEventListener('submit', handleFormSubmit);
    </script>
</body>
</html>