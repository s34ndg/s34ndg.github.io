<!DOCTYPE html>
<html>
<head>
    <title>Web Audio App</title>
    <style>
        /* Add CSS styles to customize the UI */
    </style>
</head>
<body>
<h1>Web Audio App</h1>
<button id="startButton">Start</button>
<p id="statusText">Not listening</p>
<label for="silenceDuration">Silence Duration (in seconds):</label>
<input type="number" id="silenceDuration" min="1" value="5">

<script>
        // Check for browser compatibility
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            alert('Web Audio API is not supported in this browser.');
        }

        // Get references to UI elements
        const startButton = document.getElementById('startButton');
        const statusText = document.getElementById('statusText');
        const silenceDurationInput = document.getElementById('silenceDuration');

        let isListening = false;
        let audioContext = null;
        let audioStream = null;
        let audioSource = null;
        let audioProcessor = null;
        let audioThreshold = -60; // Adjust this value based on your requirements
        let silenceDuration = parseInt(silenceDurationInput.value, 10);

        startButton.addEventListener('click', toggleListening);
        silenceDurationInput.addEventListener('input', updateSilenceDuration);

        function toggleListening() {
            if (!isListening) {
                requestAudioPermission();
            } else {
                stopListening();
            }
        }

        function requestAudioPermission() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(startListening)
                .catch(handleAudioPermissionError);
        }

        function handleAudioPermissionError(error) {
            console.error('Audio permission denied:', error);
            statusText.textContent = 'Permission denied. Please allow access to the microphone.';
        }

        function startListening(stream) {
            isListening = true;
            startButton.textContent = 'Stop';
            statusText.textContent = 'Listening...';

            audioContext = new AudioContext();
            audioStream = stream;
            audioSource = audioContext.createMediaStreamSource(audioStream);
            audioProcessor = audioContext.createScriptProcessor(4096, 1, 1);

            audioProcessor.onaudioprocess = processAudio;

            audioSource.connect(audioProcessor);
            audioProcessor.connect(audioContext.destination);
        }

        function stopListening() {
            isListening = false;
            startButton.textContent = 'Start';
            statusText.textContent = 'Not listening';

            audioProcessor.onaudioprocess = null;

            audioSource.disconnect();
            audioProcessor.disconnect();
            audioStream.getTracks().forEach(track => track.stop());

            audioContext = null;
            audioStream = null;
            audioSource = null;
            audioProcessor = null;
        }

        function processAudio(event) {
            const input = event.inputBuffer.getChannelData(0);
            let sum = 0;

            for (let i = 0; i < input.length; i++) {
                sum += input[i] ** 2;
            }

            const rms = Math.sqrt(sum / input.length);
            const db = 20 * Math.log10(rms);

            if (db < audioThreshold) {
                // Perform the action when the audio level is below the threshold for the specified duration
                silenceDuration--;
                if (silenceDuration <= 0) {
                    // For example, show a browser notification
                    showNotification('No audio detected', 'Please check your microphone or surroundings.');
                }
            } else {
                // Reset the silence duration if audio level is above the threshold
                silenceDuration = parseInt(silenceDurationInput.value, 10);
            }
        }

        function showNotification(title, message) {
            if (Notification.permission === 'granted') {
                new Notification(title, { body: message });
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission()
                    .then(permission => {
                        if (permission === 'granted') {
                            new Notification(title, { body: message });
                        }
                    });
            }
        }

        function updateSilenceDuration() {
            silenceDuration = parseInt(silenceDurationInput.value, 10);
        }
    </script>
</body>
</html>
